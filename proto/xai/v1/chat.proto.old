syntax = "proto3";

package xai.v1;

option go_package = "github.com/ZaguanLabs/xai-sdk-go/proto/gen/go/xai/v1;xaiv1";

// Chat service for conversational AI interactions
service Chat {
  // Create a chat completion
  rpc CreateChatCompletion(CreateChatCompletionRequest) returns (CreateChatCompletionResponse);

  // Stream chat completion chunks
  rpc StreamChatCompletion(CreateChatCompletionRequest) returns (stream ChatCompletionChunk);
}

// Request to create a chat completion
message CreateChatCompletionRequest {
  string model = 1;
  repeated Message messages = 2;
  float temperature = 3;
  int32 max_tokens = 4;
  repeated Tool tools = 5;
  ToolChoice tool_choice = 6;
  ResponseFormat response_format = 7;
  SearchParameters search = 8;
  string reasoning_effort = 9;
  bool store_messages = 10;
  string previous_response_id = 11;
  bool encrypted_content = 12;
}

// Response from chat completion
message CreateChatCompletionResponse {
  string id = 1;
  string model = 2;
  repeated Choice choices = 3;
  Usage usage = 4;
  string status = 5; // For deferred responses
  string created_at = 6; // For deferred responses
  string completed_at = 7; // For deferred responses
}

// Streaming chunk
message ChatCompletionChunk {
  string id = 1;
  repeated ChoiceDelta choices = 2;
}

// Message in conversation
message Message {
  string role = 1;
  string content = 2;
  repeated ToolCall tool_calls = 3; // For assistant messages with tool calls
}

// Choice in response
message Choice {
  int32 index = 1;
  Message message = 2;
  string finish_reason = 3;
}

// Delta choice for streaming
message ChoiceDelta {
  int32 index = 1;
  MessageDelta delta = 2;
}

// Message delta
message MessageDelta {
  string role = 1;
  string content = 2;
  repeated ToolCall tool_calls = 3; // For streaming tool calls
}

// Token usage information
message Usage {
  int32 prompt_tokens = 1;
  int32 completion_tokens = 2;
  int32 total_tokens = 3;
}

// Tool definition
message Tool {
  string type = 1;
  Function function = 2;
}

// Function definition for tools
message Function {
  string name = 1;
  string description = 2;
  string parameters = 3; // JSON schema
}

// Function call information
message FunctionCall {
  string name = 1;
  string arguments = 2; // JSON arguments
}

// Tool choice configuration
message ToolChoice {
  oneof choice {
    string none = 1;
    string auto = 2;
    string required = 3;
    string function = 4;
  }
}

// Response format configuration
message ResponseFormat {
  oneof format {
    string text = 1;
    string json_object = 2;
    JsonSchema json_schema = 3;
  }
}

// JSON schema for structured output
message JsonSchema {
  string schema = 1;
}

// Search parameters
message SearchParameters {
  int32 count = 1;
  repeated string domains = 2;
  string recency = 3; // "default", "day", "week", "month", "year"
}

// Tool call information
message ToolCall {
  string id = 1;
  string type = 2; // "function"
  FunctionCall function = 3;
}

// File upload request
message UploadFileRequest {
  string filename = 1;
  bytes content = 2;
  string content_type = 3;
  string purpose = 4;
}

// File upload response
message UploadFileResponse {
  string id = 1;
  string filename = 2;
  int64 size = 3;
  string content_type = 4;
  string purpose = 5;
  int64 created_at = 6;
}