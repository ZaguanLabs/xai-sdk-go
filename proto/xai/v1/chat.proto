syntax = "proto3";

package xai_api;

option go_package = "github.com/ZaguanLabs/xai-sdk-go/proto/gen/go/xai/v1;xaiv1";

import "google/protobuf/timestamp.proto";
import "xai/v1/usage.proto";
import "xai/v1/image.proto";
import "xai/v1/deferred.proto";

// Chat service for conversational AI interactions
service Chat {
  // Get a chat completion
  rpc GetCompletion(GetCompletionsRequest) returns (GetChatCompletionResponse);

  // Stream chat completion chunks
  rpc GetCompletionChunk(GetCompletionsRequest) returns (stream GetChatCompletionChunk);
}

// ============================================================================
// ENUMS
// ============================================================================

// FinishReason indicates why the completion finished
enum FinishReason {
  REASON_INVALID = 0;
  REASON_MAX_LEN = 1;
  REASON_MAX_CONTEXT = 2;
  REASON_STOP = 3;
  REASON_TOOL_CALLS = 4;
  REASON_TIME_LIMIT = 5;
}

// FormatType specifies the format of the response
enum FormatType {
  FORMAT_TYPE_INVALID = 0;
  FORMAT_TYPE_TEXT = 1;
  FORMAT_TYPE_JSON_OBJECT = 2;
  FORMAT_TYPE_JSON_SCHEMA = 3;
}

// MessageRole specifies the role of a message
enum MessageRole {
  INVALID_ROLE = 0;
  ROLE_USER = 1;
  ROLE_ASSISTANT = 2;
  ROLE_SYSTEM = 3;
  ROLE_FUNCTION = 4;
  ROLE_TOOL = 5;
}

// ReasoningEffort controls the reasoning effort level
enum ReasoningEffort {
  INVALID_EFFORT = 0;
  EFFORT_LOW = 1;
  EFFORT_MEDIUM = 2;
  EFFORT_HIGH = 3;
}

// SearchMode controls search behavior
enum SearchMode {
  INVALID_SEARCH_MODE = 0;
  OFF_SEARCH_MODE = 1;
  ON_SEARCH_MODE = 2;
  AUTO_SEARCH_MODE = 3;
}

// ToolCallType specifies the type of tool call
enum ToolCallType {
  TOOL_CALL_TYPE_INVALID = 0;
  TOOL_CALL_TYPE_CLIENT_SIDE_TOOL = 1;
  TOOL_CALL_TYPE_WEB_SEARCH_TOOL = 2;
  TOOL_CALL_TYPE_X_SEARCH_TOOL = 3;
  TOOL_CALL_TYPE_CODE_EXECUTION_TOOL = 4;
  TOOL_CALL_TYPE_COLLECTIONS_SEARCH_TOOL = 5;
  TOOL_CALL_TYPE_MCP_TOOL = 6;
  TOOL_CALL_TYPE_DOCUMENT_SEARCH_TOOL = 7;
}

// ToolMode controls tool usage behavior
enum ToolMode {
  TOOL_MODE_INVALID = 0;
  TOOL_MODE_AUTO = 1;
  TOOL_MODE_NONE = 2;
  TOOL_MODE_REQUIRED = 3;
}

// ============================================================================
// MESSAGES
// ============================================================================

// CodeExecution enables code execution tool
message CodeExecution {
}

// CollectionsSearch enables search in document collections
message CollectionsSearch {
  repeated string collection_ids = 1;
  int32 limit = 2;
}

// CompletionMessage is the message in a completion output
message CompletionMessage {
  string content = 1;
  MessageRole role = 2;
  repeated ToolCall tool_calls = 3;
  string reasoning_content = 4;
  string encrypted_content = 5;
}

// CompletionOutput is a single completion output
message CompletionOutput {
  FinishReason finish_reason = 1;
  int32 index = 2;
  CompletionMessage message = 3;
  LogProbs logprobs = 4;
}

// CompletionOutputChunk is a chunk of streaming completion output
message CompletionOutputChunk {
  Delta delta = 1;
  LogProbs logprobs = 2;
  FinishReason finish_reason = 3;
  int32 index = 4;
}

// Content represents message content (text, image, or file)
message Content {
  string text = 1;
  ImageUrlContent image_url = 2;
  FileContent file = 3;
}

// DebugOutput contains debugging information
message DebugOutput {
  int32 attempts = 1;
  string request = 2;
  string prompt = 3;
  repeated string responses = 4;
  uint32 cache_read_count = 5;
  uint64 cache_read_input_bytes = 6;
  uint32 cache_write_count = 7;
  uint64 cache_write_input_bytes = 8;
  string engine_request = 9;
  string lb_address = 10;
  string sampler_tag = 11;
  repeated string chunks = 12;
}

// DeleteStoredCompletionRequest requests deletion of a stored completion
message DeleteStoredCompletionRequest {
  string response_id = 1;
}

// DeleteStoredCompletionResponse confirms deletion
message DeleteStoredCompletionResponse {
  string response_id = 1;
}

// Delta represents incremental changes in streaming
message Delta {
  string content = 1;
  MessageRole role = 2;
  repeated ToolCall tool_calls = 3;
  string reasoning_content = 4;
  string encrypted_content = 5;
}

// DocumentSearch enables document search tool
message DocumentSearch {
  int32 limit = 2;
}

// FileContent references a file by ID
message FileContent {
  string file_id = 1;
}

// Function defines a function tool
message Function {
  string name = 1;
  string description = 2;
  bool strict = 3;
  string parameters = 4;  // JSON schema
}

// FunctionCall represents a function call
message FunctionCall {
  string name = 1;
  string arguments = 2;
}

// GetChatCompletionChunk is a streaming response chunk
message GetChatCompletionChunk {
  string id = 1;
  repeated CompletionOutputChunk outputs = 2;
  google.protobuf.Timestamp created = 3;
  string model = 4;
  string system_fingerprint = 5;
  SamplingUsage usage = 6;
  repeated string citations = 7;
}

// GetChatCompletionResponse is the complete response
message GetChatCompletionResponse {
  string id = 1;
  repeated CompletionOutput outputs = 2;
  google.protobuf.Timestamp created = 5;
  string model = 6;
  string system_fingerprint = 7;
  SamplingUsage usage = 9;
  repeated string citations = 10;
  RequestSettings settings = 11;
  DebugOutput debug_output = 12;
}

// GetCompletionsRequest is the main request for chat completions
message GetCompletionsRequest {
  repeated Message messages = 1;
  string model = 2;
  float frequency_penalty = 3;
  bool logprobs = 5;
  int32 top_logprobs = 6;
  int32 max_tokens = 7;
  int32 n = 8;
  float presence_penalty = 9;
  ResponseFormat response_format = 10;
  int32 seed = 11;
  repeated string stop = 12;
  float temperature = 14;
  float top_p = 15;
  string user = 16;
  repeated Tool tools = 17;
  ToolChoice tool_choice = 18;
  ReasoningEffort reasoning_effort = 19;
  SearchParameters search_parameters = 20;
  bool parallel_tool_calls = 21;
  string previous_response_id = 22;
  bool store_messages = 23;
  bool use_encrypted_content = 24;
}

// GetDeferredCompletionResponse is response for deferred completions
message GetDeferredCompletionResponse {
  GetChatCompletionResponse response = 1;
  DeferredStatus status = 2;
}

// GetStoredCompletionRequest requests a stored completion
message GetStoredCompletionRequest {
  string response_id = 1;
}

// LogProb represents log probability for a token
message LogProb {
  string token = 1;
  float logprob = 2;
  bytes bytes = 3;
  repeated TopLogProb top_logprobs = 4;
}

// LogProbs contains log probabilities
message LogProbs {
  repeated LogProb content = 1;
}

// MCP (Model Context Protocol) configuration
message MCP {
  message ExtraHeadersEntry {
    string key = 1;
    string value = 2;
  }
  
  string server_label = 1;
  string server_description = 2;
  string server_url = 3;
  repeated string allowed_tool_names = 4;
  string authorization = 5;
  repeated ExtraHeadersEntry extra_headers = 6;
}

// Message represents a chat message
message Message {
  repeated Content content = 1;
  MessageRole role = 2;
  string name = 3;
  repeated ToolCall tool_calls = 4;
  string reasoning_content = 5;
  string encrypted_content = 6;
}

// NewsSource configures news search
message NewsSource {
  repeated string excluded_websites = 2;
  string country = 3;
  bool safe_search = 4;
}

// RequestSettings captures the settings used for a request
message RequestSettings {
  int32 max_tokens = 1;
  bool parallel_tool_calls = 2;
  string previous_response_id = 3;
  ReasoningEffort reasoning_effort = 4;
  float temperature = 5;
  ResponseFormat response_format = 6;
  ToolChoice tool_choice = 7;
  repeated Tool tools = 8;
  float top_p = 9;
  string user = 10;
  SearchParameters search_parameters = 11;
  bool store_messages = 12;
  bool use_encrypted_content = 13;
}

// ResponseFormat specifies the desired response format
message ResponseFormat {
  FormatType format_type = 1;
  string schema = 2;  // JSON schema when format_type is JSON_SCHEMA
}

// RssSource configures RSS feed search
message RssSource {
  repeated string links = 1;
}

// SearchParameters configures search behavior
message SearchParameters {
  SearchMode mode = 1;
  google.protobuf.Timestamp from_date = 4;
  google.protobuf.Timestamp to_date = 5;
  bool return_citations = 7;
  int32 max_search_results = 8;
  repeated Source sources = 9;
}

// Source specifies search sources
message Source {
  WebSource web = 1;
  NewsSource news = 2;
  XSource x = 3;
  RssSource rss = 4;
}

// Tool defines available tools
message Tool {
  Function function = 1;
  WebSearch web_search = 3;
  XSearch x_search = 4;
  CodeExecution code_execution = 5;
  CollectionsSearch collections_search = 6;
  MCP mcp = 7;
  DocumentSearch document_search = 8;
}

// ToolCall represents a tool invocation
message ToolCall {
  string id = 1;
  ToolCallType type = 2;
  FunctionCall function = 10;
}

// ToolChoice controls tool selection
message ToolChoice {
  ToolMode mode = 1;
  string function_name = 2;
}

// TopLogProb represents top log probabilities
message TopLogProb {
  string token = 1;
  float logprob = 2;
  bytes bytes = 3;
}

// WebSearch configures web search tool
message WebSearch {
  repeated string excluded_domains = 1;
  repeated string allowed_domains = 2;
  bool enable_image_understanding = 3;
}

// WebSource configures web search source
message WebSource {
  repeated string excluded_websites = 2;
  string country = 3;
  bool safe_search = 4;
  repeated string allowed_websites = 5;
}

// XSearch configures X (Twitter) search tool
message XSearch {
  google.protobuf.Timestamp from_date = 1;
  google.protobuf.Timestamp to_date = 2;
  repeated string allowed_x_handles = 3;
  repeated string excluded_x_handles = 4;
  bool enable_image_understanding = 5;
  bool enable_video_understanding = 6;
}

// XSource configures X (Twitter) search source
message XSource {
  repeated string included_x_handles = 7;
  repeated string excluded_x_handles = 8;
  int32 post_favorite_count = 9;
  int32 post_view_count = 10;
}

